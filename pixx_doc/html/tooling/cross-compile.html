<!DOCTYPE html>
<html class="writer-html5" lang="fr" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cross-compilation via Docker &mdash; Documentation WSFR Mobile Robotic Team </title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=bd5b14eb" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/general.css?v=c0a7eb24" />
      <link rel="stylesheet" type="text/css" href="../_static/dark_mode_css/dark.css?v=70edf1c7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=d1a510d7"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script src="../_static/translations.js?v=d99ca74e"></script>
        <script src="../_static/dark_mode_js/default_dark.js?v=fd565c74"></script>
        <script src="../_static/dark_mode_js/theme_switcher.js?v=358d3910"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Generate ready to use ISO-files for RPi" href="generate-iso.html" />
    <link rel="prev" title="Tooling" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            WSFR Mobile Robotic Team
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Rechercher docs" aria-label="Rechercher docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../orga/index.html">Organisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ros/index.html">ROS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../robots/index.html">Robots</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tooling</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Cross-compilation via Docker</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#utiliser-docker-pour-la-cross-compilation">Utiliser Docker pour la cross-compilation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#installer-docker">Installer Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#utiliser-le-repo-ros2-docker">Utiliser le repo ros2-docker</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="generate-iso.html">Generate ready to use ISO-files for RPi</a></li>
<li class="toctree-l2"><a class="reference internal" href="dfu-flash.html">Flash Titan DFU via Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">Glossaire</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">Contribuer</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WSFR Mobile Robotic Team</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Tooling</a></li>
      <li class="breadcrumb-item active">Cross-compilation via Docker</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/tooling/cross-compile.rst.txt" rel="nofollow"> Afficher la source de la page</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cross-compilation-via-docker">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Cross-compilation via Docker</a><a class="headerlink" href="#cross-compilation-via-docker" title="Link to this heading"></a></h1>
<p>Nous avons développé un outil qui permet de cross-compiler.
Imaginons que nous voulons compiler un code pour RPi, mais que nous ne voulons pas attendre une
éternité parce que ça compile trop lentement sur notre petite RPi.</p>
<p>Aussi, la RPi n’a pas de RTC (real-time clock) ce qui, si elle n’est pas connectée à internet (comme
en compétition par exemple), ne lui permet pas de garder l’heure à jour. Le problème de cela est
que, quand vous allez changer le code, il se pourrait que la RPi se réinitialise à une date
antérieure à votre dernière compilation. Ce qui aura pour effet de laisser croire au compilateur de
votre RPi que le programme est déjà à jour, ce qui n’est pas forcément le cas.</p>
<p>En bref la cross-compilation va nous résoudre deux gros problèmes en compétition :</p>
<ul class="simple">
<li><p>le temps de compilation</p></li>
<li><p>la date des binaires générés</p></li>
</ul>
<p>Nous allons donc expliquer comment l’utiliser avec Docker dans un premier temps.</p>
<p>Et dans un second temps générer ou actualiser son/ses propres Docker.</p>
<nav class="contents" id="sommaire">
<p class="topic-title">Sommaire</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cross-compilation-via-docker" id="id1">Cross-compilation via Docker</a></p>
<ul>
<li><p><a class="reference internal" href="#utiliser-docker-pour-la-cross-compilation" id="id2">Utiliser Docker pour la cross-compilation</a></p>
<ul>
<li><p><a class="reference internal" href="#installer-docker" id="id3">Installer Docker</a></p></li>
<li><p><a class="reference internal" href="#utiliser-le-repo-ros2-docker" id="id4">Utiliser le repo ros2-docker</a></p>
<ul>
<li><p><a class="reference internal" href="#cloner-le-repo" id="id5">Cloner le repo</a></p></li>
<li><p><a class="reference internal" href="#generer-le-script-de-base" id="id6">Générer le script de base</a></p></li>
<li><p><a class="reference internal" href="#pull-docker-image-existante" id="id7">Pull docker image existante</a></p></li>
<li><p><a class="reference internal" href="#cross-compilation" id="id8">Cross-compilation</a></p></li>
<li><p><a class="reference internal" href="#deployement" id="id9">Deployement</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="utiliser-docker-pour-la-cross-compilation">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Utiliser Docker pour la cross-compilation</a><a class="headerlink" href="#utiliser-docker-pour-la-cross-compilation" title="Link to this heading"></a></h2>
<section id="installer-docker">
<h3><a class="toc-backref" href="#id3" role="doc-backlink">Installer Docker</a><a class="headerlink" href="#installer-docker" title="Link to this heading"></a></h3>
<p>Premièrement, il faut installer Docker. Personnellement, j’utilise docker-ce par habitude.</p>
<ul class="simple">
<li><p>Soyez certain de bien désinstaller d’autres versions de Docker avant de commencer.</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="k">for</span><span class="w"> </span>pkg<span class="w"> </span><span class="k">in</span><span class="w"> </span>docker.io<span class="w"> </span>docker-doc<span class="w"> </span>docker-compose<span class="w"> </span>docker-compose-v2<span class="w"> </span>podman-docker<span class="w"> </span>containerd<span class="w"> </span>runc<span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span><span class="nv">$pkg</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Ajoutez la clé officielle de Docker</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span>gnupg
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/usr/share/keyrings/docker-archive-keyring.gpg
</pre></div>
</div>
<ul class="simple">
<li><p>Ajoutez le repo apt</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
</pre></div>
</div>
<ul class="simple">
<li><p>Installez docker-ce</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>docker-ce
</pre></div>
</div>
<ul class="simple">
<li><p>Verifiez que l’installation a marché</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>hello-world

<span class="c1"># Outputs</span>
Unable<span class="w"> </span>to<span class="w"> </span>find<span class="w"> </span>image<span class="w"> </span><span class="s1">&#39;hello-world:latest&#39;</span><span class="w"> </span>locally
latest:<span class="w"> </span>Pulling<span class="w"> </span>from<span class="w"> </span>library/hello-world
719385e32844:<span class="w"> </span>Pull<span class="w"> </span><span class="nb">complete</span>
Digest:<span class="w"> </span>sha256:88ec0acaa3ec199d3b7eaf73588f4518c25f9d34f58ce9a0df68429c5af48e8d
Status:<span class="w"> </span>Downloaded<span class="w"> </span>newer<span class="w"> </span>image<span class="w"> </span><span class="k">for</span><span class="w"> </span>hello-world:latest

Hello<span class="w"> </span>from<span class="w"> </span>Docker!
This<span class="w"> </span>message<span class="w"> </span>shows<span class="w"> </span>that<span class="w"> </span>your<span class="w"> </span>installation<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>working<span class="w"> </span>correctly.

To<span class="w"> </span>generate<span class="w"> </span>this<span class="w"> </span>message,<span class="w"> </span>Docker<span class="w"> </span>took<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>steps:
<span class="m">1</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>client<span class="w"> </span>contacted<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>daemon.
<span class="m">2</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span>pulled<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;hello-world&quot;</span><span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>Hub.
<span class="w">    </span><span class="o">(</span>amd64<span class="o">)</span>
<span class="m">3</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span>created<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>container<span class="w"> </span>from<span class="w"> </span>that<span class="w"> </span>image<span class="w"> </span>which<span class="w"> </span>runs<span class="w"> </span>the
<span class="w">    </span>executable<span class="w"> </span>that<span class="w"> </span>produces<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>currently<span class="w"> </span>reading.
<span class="m">4</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span>streamed<span class="w"> </span>that<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>client,<span class="w"> </span>which<span class="w"> </span>sent<span class="w"> </span>it
<span class="w">    </span>to<span class="w"> </span>your<span class="w"> </span>terminal.

To<span class="w"> </span>try<span class="w"> </span>something<span class="w"> </span>more<span class="w"> </span>ambitious,<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>run<span class="w"> </span>an<span class="w"> </span>Ubuntu<span class="w"> </span>container<span class="w"> </span>with:
$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>ubuntu<span class="w"> </span>bash

Share<span class="w"> </span>images,<span class="w"> </span>automate<span class="w"> </span>workflows,<span class="w"> </span>and<span class="w"> </span>more<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>free<span class="w"> </span>Docker<span class="w"> </span>ID:
https://hub.docker.com/

For<span class="w"> </span>more<span class="w"> </span>examples<span class="w"> </span>and<span class="w"> </span>ideas,<span class="w"> </span>visit:
https://docs.docker.com/get-started/
</pre></div>
</div>
<ul class="simple">
<li><p>Ajoutez votre utilisateur au groupe <code class="docutils literal notranslate"><span class="pre">docker</span></code> pour ne pas avoir besoin de sudo. Pour que cela
prenne effet, il est préférable de redémarrer l’ordinateur apres avoir entré la commande suivante :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
reboot<span class="w"> </span><span class="c1"># soyez sur que tout est sauvegardé sur votre ordinateur</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Après le redémarrage, vous devriez pouvoir démarrer le docker sans sudo et sans téléchargement</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>hello-world

<span class="c1"># Outputs</span>
Hello<span class="w"> </span>from<span class="w"> </span>Docker!
This<span class="w"> </span>message<span class="w"> </span>shows<span class="w"> </span>that<span class="w"> </span>your<span class="w"> </span>installation<span class="w"> </span>appears<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>working<span class="w"> </span>correctly.

To<span class="w"> </span>generate<span class="w"> </span>this<span class="w"> </span>message,<span class="w"> </span>Docker<span class="w"> </span>took<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>steps:
<span class="m">1</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>client<span class="w"> </span>contacted<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>daemon.
<span class="m">2</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span>pulled<span class="w"> </span>the<span class="w"> </span><span class="s2">&quot;hello-world&quot;</span><span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>Hub.
<span class="w">    </span><span class="o">(</span>amd64<span class="o">)</span>
<span class="m">3</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span>created<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>container<span class="w"> </span>from<span class="w"> </span>that<span class="w"> </span>image<span class="w"> </span>which<span class="w"> </span>runs<span class="w"> </span>the
<span class="w">    </span>executable<span class="w"> </span>that<span class="w"> </span>produces<span class="w"> </span>the<span class="w"> </span>output<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>currently<span class="w"> </span>reading.
<span class="m">4</span>.<span class="w"> </span>The<span class="w"> </span>Docker<span class="w"> </span>daemon<span class="w"> </span>streamed<span class="w"> </span>that<span class="w"> </span>output<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>client,<span class="w"> </span>which<span class="w"> </span>sent<span class="w"> </span>it
<span class="w">    </span>to<span class="w"> </span>your<span class="w"> </span>terminal.

To<span class="w"> </span>try<span class="w"> </span>something<span class="w"> </span>more<span class="w"> </span>ambitious,<span class="w"> </span>you<span class="w"> </span>can<span class="w"> </span>run<span class="w"> </span>an<span class="w"> </span>Ubuntu<span class="w"> </span>container<span class="w"> </span>with:
$<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>ubuntu<span class="w"> </span>bash

Share<span class="w"> </span>images,<span class="w"> </span>automate<span class="w"> </span>workflows,<span class="w"> </span>and<span class="w"> </span>more<span class="w"> </span>with<span class="w"> </span>a<span class="w"> </span>free<span class="w"> </span>Docker<span class="w"> </span>ID:
https://hub.docker.com/

For<span class="w"> </span>more<span class="w"> </span>examples<span class="w"> </span>and<span class="w"> </span>ideas,<span class="w"> </span>visit:
https://docs.docker.com/get-started/
</pre></div>
</div>
<p>Sources :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/engine/install/ubuntu/">https://docs.docker.com/engine/install/ubuntu/</a></p></li>
<li><p><a class="reference external" href="https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-22-04">https://www.digitalocean.com/community/tutorials/how-to-install-and-use-docker-on-ubuntu-22-04</a></p></li>
</ul>
</section>
<section id="utiliser-le-repo-ros2-docker">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Utiliser le repo ros2-docker</a><a class="headerlink" href="#utiliser-le-repo-ros2-docker" title="Link to this heading"></a></h3>
<p>Le lien du repo : <a class="reference external" href="https://github.com/Worldskills-France-Mobile-Robotics/ros2-docker">https://github.com/Worldskills-France-Mobile-Robotics/ros2-docker</a></p>
<p>Ce repo a pour but de faciliter le démarrage et la creation d’image docker.
Il permet:</p>
<ul class="simple">
<li><p>De compiler les packets avec les mêmes dépendances que l’image RPi (si ça ne compile pas avec le
docker, ça ne compilera pas sur la RPi)</p></li>
<li><p>Simuler l’environnement du robot dans les mêmes conditions que l’image RPi</p></li>
<li><p>Compiler pour une autre plateforme</p></li>
<li><p>Utiliser plusieurs versions de ROS en parallèle sur un seul ordinateur</p></li>
</ul>
<section id="cloner-le-repo">
<h4><a class="toc-backref" href="#id5" role="doc-backlink">Cloner le repo</a><a class="headerlink" href="#cloner-le-repo" title="Link to this heading"></a></h4>
<p>Clonez le repo où vous le souhaitez:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">WORKSPACE_ROOT</span><span class="o">=</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span>/workspace
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">WORKSPACE_ROOT</span><span class="si">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span><span class="si">${</span><span class="nv">WORKSPACE_ROOT</span><span class="si">}</span>
git<span class="w"> </span>clone<span class="w"> </span>git@github.com:Worldskills-France-Mobile-Robotics/ros2-docker.git
<span class="nb">cd</span><span class="w"> </span>ros2-docker
</pre></div>
</div>
<p>Vous allez voir l’arborescense suivante dans le dossier <cite>ros2-docker</cite> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.
├──<span class="w"> </span>docker
├──<span class="w"> </span>my-robot-template.bash
├──<span class="w"> </span>README.md
├──<span class="w"> </span>repos
└──<span class="w"> </span>scripts
</pre></div>
</div>
</section>
<section id="generer-le-script-de-base">
<h4><a class="toc-backref" href="#id6" role="doc-backlink">Générer le script de base</a><a class="headerlink" href="#generer-le-script-de-base" title="Link to this heading"></a></h4>
<p>Vous avez maintenant le repo de base.
Nous allons commencer par créer un script pour notre robot.</p>
<p>Nous avons donc besoin d’un nom de robot et de la distribution ROS. Prenons par exemple stanley et
humble.
Par default le script prendra robot et rolling.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./scripts/generate_robot_dev.bash<span class="w"> </span>stanley<span class="w"> </span>humble

<span class="c1"># outputs</span>
stanley-dev.bash<span class="w"> </span>has<span class="w"> </span>been<span class="w"> </span>generated<span class="w"> </span>and<span class="w"> </span>made<span class="w"> </span>executable
you<span class="w"> </span>can<span class="w"> </span>now<span class="w"> </span>make<span class="w"> </span>an<span class="w"> </span><span class="nb">alias</span><span class="w"> </span>linked<span class="w"> </span>to<span class="w"> </span>it<span class="w"> </span>to<span class="w"> </span>be<span class="w"> </span>able<span class="w"> </span>to<span class="w"> </span>execute<span class="w"> </span>from<span class="w"> </span>anywhere
<span class="k">for</span><span class="w"> </span>example:
<span class="w">  </span><span class="nb">alias</span><span class="w"> </span>stanley-dev<span class="o">=</span><span class="s2">&quot;/tmp/ros2-docker/stanley-dev.bash&quot;</span>

you<span class="w"> </span>have<span class="w"> </span>a<span class="w"> </span>.bash_aliases<span class="w"> </span>the<span class="w"> </span>following<span class="w"> </span>will<span class="w"> </span>append<span class="w"> </span>to<span class="w"> </span>it

<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# thoses are variables for stanley-dev&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bash_aliases
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;alias stanley-dev=&quot;</span>/tmp/ros2-docker/stanley-dev.bash<span class="s2">&quot;&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bash_aliases
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export STANLEY_ROS_DISTRO=humble&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bash_aliases
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;export STANLEY_ROOT=/home/flochre/workspace/robot_ws&quot;</span><span class="w"> </span>&gt;&gt;<span class="w"> </span>~/.bash_aliases

Please<span class="w"> </span>make<span class="w"> </span>sure<span class="w"> </span>this<span class="w"> </span>is<span class="w"> </span>what<span class="w"> </span>you<span class="w"> </span>want<span class="w"> </span>before<span class="w"> </span>copying<span class="w"> </span>it<span class="w"> </span>to<span class="w"> </span>you<span class="w"> </span>bash_aliases
</pre></div>
</div>
<p>Nous venons de créer un fichier stanley-dev.bash qui va nous permettre d’utiliser le docker
facilement.
Le script nous conseille également de créer un alias et deux variables d’environnement et prépare
les lignes à ajouter à notre .bash_aliases.</p>
<p>Je ne peux que vous recommander vivement de le faire :)</p>
<p>Le script a une aide interne, vous pouvez la voir en utilisant le flag -h ou –help :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./stanley-dev.bash<span class="w"> </span>--help

<span class="c1"># outputs</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
Usage:<span class="w">  </span>stanley-dev.bash<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>COMMAND

A<span class="w"> </span>simple<span class="w"> </span>script<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>and<span class="w"> </span>abuse<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>ros2-docker

Common<span class="w"> </span>Commands:
<span class="w">  </span>run<span class="w">           </span>Create<span class="w"> </span>and<span class="w"> </span>run<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>container<span class="w"> </span>from<span class="w"> </span>an<span class="w"> </span>image
<span class="w">  </span><span class="nb">exec</span><span class="w">          </span>Execute<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>running<span class="w"> </span>container
<span class="w">  </span>cross-compile<span class="w"> </span>Cross-compile<span class="w"> </span>a<span class="w"> </span>workspace<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>dedicated<span class="w"> </span>container
<span class="w">  </span>deploy<span class="w">        </span>Deploy<span class="w"> </span>the<span class="w"> </span>cross-compile<span class="w"> </span>code<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>host
<span class="w">  </span>build<span class="w">         </span>Build<span class="w"> </span>the<span class="w"> </span>image<span class="w"> </span><span class="k">for</span><span class="w"> </span>ros2-docker
<span class="w">  </span>pull<span class="w">          </span>Download<span class="w"> </span>an<span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>registry
</pre></div>
</div>
<p>Une fois l’alias et les variables d’environment créées, nous pouvons utiliser directement l’alias
de n’importe où sur notre ordinateur :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>--help

<span class="c1"># outputs</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
Usage:<span class="w">  </span>stanley-dev.bash<span class="w"> </span><span class="o">[</span>OPTIONS<span class="o">]</span><span class="w"> </span>COMMAND

A<span class="w"> </span>simple<span class="w"> </span>script<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span>and<span class="w"> </span>abuse<span class="w"> </span>from<span class="w"> </span>the<span class="w"> </span>ros2-docker

Common<span class="w"> </span>Commands:
<span class="w">  </span>run<span class="w">           </span>Create<span class="w"> </span>and<span class="w"> </span>run<span class="w"> </span>a<span class="w"> </span>new<span class="w"> </span>container<span class="w"> </span>from<span class="w"> </span>an<span class="w"> </span>image
<span class="w">  </span><span class="nb">exec</span><span class="w">          </span>Execute<span class="w"> </span>a<span class="w"> </span><span class="nb">command</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>running<span class="w"> </span>container
<span class="w">  </span>cross-compile<span class="w"> </span>Cross-compile<span class="w"> </span>a<span class="w"> </span>workspace<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>dedicated<span class="w"> </span>container
<span class="w">  </span>deploy<span class="w">        </span>Deploy<span class="w"> </span>the<span class="w"> </span>cross-compile<span class="w"> </span>code<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>host
<span class="w">  </span>build<span class="w">         </span>Build<span class="w"> </span>the<span class="w"> </span>image<span class="w"> </span><span class="k">for</span><span class="w"> </span>ros2-docker
<span class="w">  </span>pull<span class="w">          </span>Download<span class="w"> </span>an<span class="w"> </span>image<span class="w"> </span>from<span class="w"> </span>a<span class="w"> </span>registry
</pre></div>
</div>
</section>
<section id="pull-docker-image-existante">
<h4><a class="toc-backref" href="#id7" role="doc-backlink">Pull docker image existante</a><a class="headerlink" href="#pull-docker-image-existante" title="Link to this heading"></a></h4>
<p>Regardons d’abord les paramètres possibles</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>pull<span class="w"> </span>-h
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
pull_docker.bash<span class="w"> </span><span class="o">[</span>-h<span class="p">|</span>--help<span class="o">]</span><span class="w"> </span><span class="o">[</span>-d<span class="p">|</span>--rosdistro<span class="w"> </span>string<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>pull<span class="w"> </span>the<span class="w"> </span>docker<span class="w"> </span>image<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>parameters

where:
<span class="w">    </span>-h<span class="w"> </span><span class="p">|</span>--help<span class="w">        </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>text
<span class="w">    </span>-a<span class="w"> </span><span class="p">|</span>--arch<span class="w">        </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>architecture<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>aarch64<span class="o">)</span><span class="w"> </span>other<span class="w"> </span>option:<span class="w"> </span>x86_64
<span class="w">    </span>-d<span class="w"> </span><span class="p">|</span>--rosdistro<span class="w">   </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>rosdistro<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>humble<span class="o">)</span>
<span class="w">    </span>-u<span class="w"> </span><span class="p">|</span>--user<span class="w">        </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>docker<span class="w"> </span>user<span class="w"> </span>name<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>flochre<span class="o">)</span>
<span class="w">    </span>-v<span class="w"> </span><span class="p">|</span>--version<span class="w">     </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>version<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>Tag<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>latest<span class="o">)</span>
</pre></div>
</div>
<p>Voyez que le script vous propose les valeurs qu’il utilisera par default.
Verifiez qu’elles correspondent à ce que vous souhaitez.</p>
<p>Vous allez pour la première fois vouloir récuperer l’image de mon compte et je vais forcer humble
pour l’example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>pull<span class="w"> </span>-d<span class="w"> </span>humble<span class="w"> </span>-u<span class="w"> </span>flochre

<span class="c1"># outputs</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
latest:<span class="w"> </span>Pulling<span class="w"> </span>from<span class="w"> </span>flochre/ros2_docker_humble
Digest:<span class="w"> </span>sha256:c86b3f0556ed625b1dc18d142d3465b9b025fb13cdbe51ae07f0963a5b2e355a
Status:<span class="w"> </span>Image<span class="w"> </span>is<span class="w"> </span>up<span class="w"> </span>to<span class="w"> </span>date<span class="w"> </span><span class="k">for</span><span class="w"> </span>flochre/ros2_docker_humble:latest
docker.io/flochre/ros2_docker_humble:latest
</pre></div>
</div>
<p>Nous pouvons maintenant utiliser le docker comme un autre ordinateur où faire de la
cross-compilation.</p>
</section>
<section id="cross-compilation">
<h4><a class="toc-backref" href="#id8" role="doc-backlink">Cross-compilation</a><a class="headerlink" href="#cross-compilation" title="Link to this heading"></a></h4>
<p>Le script nous avait proposé d’utiliser des variables d’environnement, je vais donc les utiliser
maintenant pour créer un ros2 workspace à cross-compiler.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">STANLEY_ROOT</span><span class="o">=</span><span class="nv">$HOME</span>/workspace/robot_ws
mkdir<span class="w"> </span>-p<span class="w"> </span><span class="nv">$STANLEY_ROOT</span>/src
vcs-import<span class="w"> </span>--input<span class="w"> </span>repos/minimum_release_1_ws.humble.repos<span class="w"> </span>--recursive<span class="w"> </span><span class="nv">$STANLEY_ROOT</span>/src
</pre></div>
</div>
<p>Cela va cloner tous les repos au minimum nécessaires pour démarrer le robot, dans le fichier
$STANLEY_ROOT utilisé par défaut par le script.</p>
<p>On peut regarder l’aide avant de l’utiliser avec –help</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>cross-compile<span class="w"> </span>--help

<span class="c1"># output</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
compile_docker.bash<span class="w"> </span><span class="o">[</span>-h<span class="p">|</span>--help<span class="o">]</span><span class="w"> </span><span class="o">[</span>-a<span class="p">|</span>--arch<span class="w"> </span>string<span class="o">]</span><span class="w"> </span><span class="o">[</span>-p<span class="p">|</span>--package<span class="w"> </span>string<span class="o">]</span><span class="w"> </span><span class="o">[</span>-d<span class="p">|</span>--rosdistro<span class="w"> </span>string<span class="o">]</span><span class="w"> </span><span class="o">[</span>-ws<span class="p">|</span>--workspace<span class="w"> </span>string<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>compile<span class="w"> </span>inside<span class="w"> </span>docker<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>parameters

where:
<span class="w">    </span>-h<span class="w"> </span><span class="p">|</span>--help<span class="w">        </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>text
<span class="w">    </span>-a<span class="w"> </span><span class="p">|</span>--arch<span class="w">        </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>architecture<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>aarch64<span class="o">)</span><span class="w"> </span>other<span class="w"> </span>option:<span class="w"> </span>x86_64
<span class="w">    </span>-p<span class="w"> </span><span class="p">|</span>--package<span class="w">     </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>package<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span><span class="o">(</span>--packages-up-to<span class="o">)</span><span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>ALL<span class="o">)</span>
<span class="w">    </span>-d<span class="w"> </span><span class="p">|</span>--rosdistro<span class="w">   </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>rosdistro<span class="w"> </span>to<span class="w"> </span>use<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>humble<span class="o">)</span>
<span class="w">    </span>-u<span class="w"> </span><span class="p">|</span>--user<span class="w">        </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>docker<span class="w"> </span>user<span class="w"> </span>name<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>flochre<span class="o">)</span>
<span class="w">    </span>-v<span class="w"> </span><span class="p">|</span>--version<span class="w">     </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>version<span class="w"> </span><span class="k">for</span><span class="w"> </span>the<span class="w"> </span>Docker<span class="w"> </span>Tag<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>latest<span class="o">)</span>
<span class="w">    </span>-ws<span class="p">|</span>--workspace<span class="w">   </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>workspace<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>/home/flochre/workspace/robot_ws<span class="o">)</span>
</pre></div>
</div>
<p>Verifiez que les valeurs par default vous conviennent. Et retirez le –help dans la commande.
Pour l’exemple, je ne souhaite pas tout compiler et je vais choisir uniquement de compiler jusqu’au
package flo_drive.</p>
<p>Il se peut que vous ayez un problème lors de la première compilation… Mais il se peut que cela
revienne aussi périodiquement après des mises à jour de docker par exemple. Dans ce cas :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--rm<span class="w"> </span>--privileged<span class="w"> </span>multiarch/qemu-user-static<span class="w"> </span>--credential<span class="w"> </span>yes<span class="w"> </span>--persistent<span class="w"> </span>yes
</pre></div>
</div>
<p>La compilation :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>cross-compile<span class="w"> </span>-p<span class="w"> </span>flo_drive

<span class="c1"># outputs</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
Starting<span class="w"> </span>&gt;&gt;&gt;<span class="w"> </span>flo_drive
<span class="o">[</span>Processing:<span class="w"> </span>flo_drive<span class="o">]</span>
<span class="o">[</span>Processing:<span class="w"> </span>flo_drive<span class="o">]</span>
<span class="o">[</span>Processing:<span class="w"> </span>flo_drive<span class="o">]</span>
---<span class="w"> </span>stderr:<span class="w"> </span>flo_drive
In<span class="w"> </span>file<span class="w"> </span>included<span class="w"> </span>from<span class="w"> </span>/workspace/robot_ws/src/flo_drive/src/flo_drive/simple_holonomic_motor.cpp:1:
/workspace/robot_ws/src/flo_drive/include/flo_drive/simple_holonomic_motor.h:<span class="w"> </span>In<span class="w"> </span>constructor<span class="w"> </span>‘SimpleHolonomicMotor::SimpleHolonomicMotor<span class="o">(</span>rclcpp::Node*,<span class="w"> </span>std::string,<span class="w"> </span>std::string,<span class="w"> </span>double,<span class="w"> </span>int,<span class="w"> </span>int,<span class="w"> </span>int,<span class="w"> </span>double,<span class="w"> </span>double,<span class="w"> </span>double,<span class="w"> </span>std::vector&lt;double,<span class="w"> </span>std::allocator&lt;double&gt;<span class="w"> </span>&gt;,<span class="w"> </span>std::vector&lt;double,<span class="w"> </span>std::allocator&lt;double&gt;<span class="w"> </span>&gt;<span class="o">)</span>’:
/workspace/robot_ws/src/flo_drive/include/flo_drive/simple_holonomic_motor.h:48:9:<span class="w"> </span>warning:<span class="w"> </span>‘SimpleHolonomicMotor::max_motor_speed_pwm_’<span class="w"> </span>will<span class="w"> </span>be<span class="w"> </span>initialized<span class="w"> </span>after<span class="w"> </span><span class="o">[</span>-Wreorder<span class="o">]</span>
<span class="w">  </span><span class="m">48</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>int<span class="w"> </span>max_motor_speed_pwm_<span class="p">;</span>
<span class="w">      </span><span class="p">|</span><span class="w">         </span>^~~~~~~~~~~~~~~~~~~~
/workspace/robot_ws/src/flo_drive/include/flo_drive/simple_holonomic_motor.h:44:9:<span class="w"> </span>warning:<span class="w">   </span>‘int<span class="w"> </span>SimpleHolonomicMotor::ticks_per_round_’<span class="w"> </span><span class="o">[</span>-Wreorder<span class="o">]</span>
<span class="w">  </span><span class="m">44</span><span class="w"> </span><span class="p">|</span><span class="w">     </span>int<span class="w"> </span>ticks_per_round_<span class="p">;</span>
<span class="w">      </span><span class="p">|</span><span class="w">         </span>^~~~~~~~~~~~~~~~
/workspace/robot_ws/src/flo_drive/src/flo_drive/simple_holonomic_motor.cpp:4:1:<span class="w"> </span>warning:<span class="w">   </span>when<span class="w"> </span>initialized<span class="w"> </span>here<span class="w"> </span><span class="o">[</span>-Wreorder<span class="o">]</span>
<span class="w">    </span><span class="m">4</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>SimpleHolonomicMotor::SimpleHolonomicMotor<span class="o">(</span>rclcpp::Node<span class="w"> </span>*driver_node,<span class="w"> </span>std::string<span class="w"> </span>motor_pub_name,<span class="w"> </span>std::string<span class="w"> </span>encoder_sub_name,
<span class="w">      </span><span class="p">|</span><span class="w"> </span>^~~~~~~~~~~~~~~~~~~~
---
Finished<span class="w"> </span><span class="o">&lt;&lt;&lt;</span><span class="w"> </span>flo_drive<span class="w"> </span><span class="o">[</span>1min<span class="w"> </span>47s<span class="o">]</span>

Summary:<span class="w"> </span><span class="m">1</span><span class="w"> </span>package<span class="w"> </span>finished<span class="w"> </span><span class="o">[</span>1min<span class="w"> </span>53s<span class="o">]</span>
<span class="w">  </span><span class="m">1</span><span class="w"> </span>package<span class="w"> </span>had<span class="w"> </span>stderr<span class="w"> </span>output:<span class="w"> </span>flo_drive
PASS
</pre></div>
</div>
<p>Après la compilation :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ll<span class="w"> </span><span class="nv">$STANLEY_ROOT</span>

<span class="c1"># outputs</span>
total<span class="w"> </span><span class="m">24</span>
drwxrwxr-x<span class="w"> </span><span class="m">6</span><span class="w"> </span>flochre<span class="w"> </span>flochre<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:01<span class="w"> </span>./
drwxrwxr-x<span class="w"> </span><span class="m">8</span><span class="w"> </span>flochre<span class="w"> </span>flochre<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">16</span>:15<span class="w"> </span>../
drwxr-xr-x<span class="w"> </span><span class="m">3</span><span class="w"> </span>flochre<span class="w"> </span>flochre<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:01<span class="w"> </span>build_aarch64/
drwxr-xr-x<span class="w"> </span><span class="m">3</span><span class="w"> </span>flochre<span class="w"> </span>flochre<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:03<span class="w"> </span>install_aarch64/
drwxr-xr-x<span class="w"> </span><span class="m">3</span><span class="w"> </span>flochre<span class="w"> </span>flochre<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">17</span>:01<span class="w"> </span>log/
drwxrwxr-x<span class="w"> </span><span class="m">7</span><span class="w"> </span>flochre<span class="w"> </span>flochre<span class="w"> </span><span class="m">4096</span><span class="w"> </span>Nov<span class="w">  </span><span class="m">4</span><span class="w"> </span><span class="m">16</span>:18<span class="w"> </span>src/
</pre></div>
</div>
<p>On voit que le docker a généré des dossiers de compilation classiques ROS (<code class="docutils literal notranslate"><span class="pre">log</span></code>, <code class="docutils literal notranslate"><span class="pre">build</span></code> et
<code class="docutils literal notranslate"><span class="pre">install</span></code>). Ici, l’architecture est spécifiée (aarch64), étant celle de la RPi, on peut les
utiliser directement dessus via le déploiement.</p>
<p>Félicitations, vous venez de créer vos premiers packages via cross-compilation :)</p>
<p>J’ai fait le test de compiler sur la RPi et sur mon ordinateur :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cross-compiled</span>
Summary:<span class="w"> </span><span class="m">5</span><span class="w"> </span>packages<span class="w"> </span>finished<span class="w"> </span><span class="o">[</span>3min<span class="w"> </span>47s<span class="o">]</span>
<span class="w">  </span><span class="m">3</span><span class="w"> </span>packages<span class="w"> </span>had<span class="w"> </span>stderr<span class="w"> </span>output:<span class="w"> </span>flo_drive<span class="w"> </span>ros2_vmxpi<span class="w"> </span>ydlidar_ros2_driver

<span class="c1"># RPi</span>
<span class="c1"># need the flag --executor sequential to compile</span>
Summary:<span class="w"> </span><span class="m">5</span><span class="w"> </span>packages<span class="w"> </span>finished<span class="w"> </span><span class="o">[</span>11min<span class="w"> </span>48s<span class="o">]</span>
<span class="w">  </span><span class="m">3</span><span class="w"> </span>packages<span class="w"> </span>had<span class="w"> </span>stderr<span class="w"> </span>output:<span class="w"> </span>flo_drive<span class="w"> </span>ros2_vmxpi<span class="w"> </span>ydlidar_ros2_driver
</pre></div>
</div>
</section>
<section id="deployement">
<h4><a class="toc-backref" href="#id9" role="doc-backlink">Deployement</a><a class="headerlink" href="#deployement" title="Link to this heading"></a></h4>
<p>Nous allons maintenant copier nos fichiers compilés sur la RPi</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>deploy<span class="w"> </span>-h

<span class="c1"># outputs</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
deploy_install.bash<span class="w"> </span><span class="o">[</span>-h<span class="p">|</span>--help<span class="o">]</span><span class="w"> </span><span class="o">[</span>-a<span class="p">|</span>--arch<span class="w"> </span>string<span class="o">]</span><span class="w"> </span><span class="o">[</span>-p<span class="p">|</span>--package<span class="w"> </span>string<span class="o">]</span><span class="w"> </span><span class="o">[</span>-d<span class="p">|</span>--rosdistro<span class="w"> </span>string<span class="o">]</span><span class="w"> </span><span class="o">[</span>-ws<span class="p">|</span>--workspace<span class="w"> </span>string<span class="o">]</span><span class="w"> </span>--<span class="w"> </span>compile<span class="w"> </span>inside<span class="w"> </span>docker<span class="w"> </span>based<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>given<span class="w"> </span>parameters

where:
<span class="w">    </span>-h<span class="w"> </span><span class="p">|</span>--help<span class="w">        </span>show<span class="w"> </span>this<span class="w"> </span><span class="nb">help</span><span class="w"> </span>text
<span class="w">    </span>-d<span class="w"> </span><span class="p">|</span>--dir<span class="w">         </span>the<span class="w"> </span>folder<span class="w"> </span>on<span class="w"> </span>the<span class="w"> </span>destination<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>deployement<span class="o">)</span>
<span class="w">    </span>-r<span class="w"> </span><span class="p">|</span>--host<span class="w">        </span>the<span class="w"> </span>ssh<span class="w"> </span>name<span class="w"> </span><span class="o">(</span>Robot<span class="w"> </span>name<span class="o">)</span><span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>host<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>destination<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>flochre@10.42.33.78<span class="o">)</span>
<span class="w">    </span>-s<span class="w"> </span><span class="p">|</span>--sudo<span class="w">        </span><span class="k">if</span><span class="w"> </span>given<span class="w"> </span>will<span class="w"> </span>copy<span class="w"> </span>with<span class="w"> </span>sudo<span class="w"> </span>rights<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span><span class="nb">false</span><span class="o">)</span>
<span class="w">    </span>-ws<span class="p">|</span>--workspace<span class="w">   </span><span class="nb">set</span><span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>of<span class="w"> </span>the<span class="w"> </span>workspace<span class="w"> </span>to<span class="w"> </span>compile<span class="w"> </span><span class="o">(</span>default:<span class="w"> </span>/home/flochre/workspace/robot_ws<span class="o">)</span>
</pre></div>
</div>
<p>Par défaut, les fichiers seront upload dans le dossier <code class="docutils literal notranslate"><span class="pre">~/deployement</span></code>.</p>
<p>Si vous avez defini des hosts dans la config de votre ssh (probablement <code class="docutils literal notranslate"><span class="pre">~/.ssh/config</span></code>), vous
pouvez directement les utiliser pour l’host (-r | –host).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>stanley-dev<span class="w"> </span>deploy<span class="w"> </span>-r<span class="w"> </span>stanley2_wifi_direct

<span class="c1"># output</span>
Welcome<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>stanley-dev!
Deploying<span class="w"> </span>/home/flochre/workspace/robot_ws/install_aarch64/<span class="w"> </span>to<span class="w"> </span>stanley2_wifi_direct:deployement<span class="w"> </span>...
PASS
</pre></div>
</div>
<p>Après ça, vous pouvez SSH sur la RPi et utiliser la commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>.<span class="w"> </span>deployement/local_setup.bash

<span class="c1"># and use the packages as if you compiled them</span>
ros2<span class="w"> </span>launch<span class="w"> </span>flo_drive<span class="w"> </span>...
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pied de page">
        <a href="index.html" class="btn btn-neutral float-left" title="Tooling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Précédent</a>
        <a href="generate-iso.html" class="btn btn-neutral float-right" title="Generate ready to use ISO-files for RPi" accesskey="n" rel="next">Suivant <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Droits d'auteur 2023, Florent CHRETIEN, Mélanie LELAURE, Lucas SI LARBI, Antoine GROS.</p>
  </div>

  Compilé avec <a href="https://www.sphinx-doc.org/">Sphinx</a> en utilisant un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">thème</a>
    fourni par <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>